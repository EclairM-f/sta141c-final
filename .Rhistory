mtcars
filter(mtcars, groups == i)
filter(mtcars, group == i)
filter(mtcars, group == 1)
filter(mtcars, carb == 4)
filter(mtcars, "carb" == 4)
mtcars[which(group==1),]
mtcars
mtcars2 <- mtcars
mtcars2
mtcar2[which(group==1),]
mtcars2[which(group==1),]
mtcars2$group=groups
mtcars2[which(mtcars2$group==1),]
groups <- sample(seq_len(3), nrow(mtcars), replace = TRUE)
dir.create("mtcars/", showWarnings = FALSE)
mtcars$group=groups
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars2$group==1),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
file_names
seq_len(m)
groups <- sample(seq_len(3), nrow(mtcars), replace = TRUE)
dir.create("mtcars/", showWarnings = FALSE)
mtcars$group=groups
for (i in seq_len(3)) {
write_csv(mtcars[which(mtcars2$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(filter(mtcars, groups == i), str_c("mtcars/", i, ".csv"))
}
mtcars$group
mtcars
for (i in seq_len(m)) {
write_csv(filter(mtcars, mtcars$groups == i), str_c("mtcars/", i, ".csv"))
}
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
file_names
blblm(arr_time~dep_delay,file_names,B=40)
mtcars
blblm(mpg~cyl*wt,file_names,B=40)
fit <- blblm(mpg~cyl*wt,file_names,B=40)
fit1 <- blblm(mpg~cyl*wt,file_names,B=40)
fit1 <- blblm(mpg~cyl*wt,file_names,B=400)
coef(fit)
fit1 <- blblm(mpg~cyl*wt,file_names,B=1000)
fit1 <- blblm(mpg~cyl*wt,file_names,B=1000)
coef(fit)
fit1 <- blblm(mpg~cyl*hp,file_names,B=1000)
coef(fit)
m <- 5
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
dir.create("mtcars/", showWarnings = FALSE)
mtcars
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
fit1 <- blblm(mpg~cyl*hp,file_names,B=1000)
m <- 5
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
m <- 5
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
groups
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
write_csv(mtcars[which(mtcars$group==4),], str_c("mtcars/", 4, ".csv"))
mtcars[which(mtcars$group==4),]
mtcars
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
fit1 <- blblm(mpg~cyl*hp,file_names,B=1000)
fit1 <- blblm(mpg~cyl*hp,file_names,B=1000)
coef(fit)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit)
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit)
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=100)
coef(fit)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=100)
coef(fit)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=100)
coef(fit)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=100)
coef(fit)
fit1 <- blblm(mpg ~ hp,file_names,B=100)
coef(fit)
fit1 <- blblm(mpg ~ hp,file_names,B=100)
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
fit1 <- blblm(mpg ~ hp,file_names,B=100)
coef(fit)
fit1 <- blblm(mpg ~ hp,file_names,B=100)
coef(fit1)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=100)
coef(fit1)
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit1)
fit2 <- par_blblm(mpg ~ wt * hp,file_names,B=1000,cl=4)
coef(fit2)
fit2 <- par_blblm(mpg ~ wt,file_names,B=1000,cl=4)
fit2 <- par_blblm(mpg ~ wt,file_names,B=1000,cl=2)
coef(fit2)
par_blblm(mpg ~ wt,file_names,B=100,cl=2)
file_names
estimates<- future_map(file_names,~{
df <- read_csv(., col_types = cols())
lm_each_subsample(mpg ~ wt, data = df, n = nrow(df), B = 40)
})
suppressWarnings(plan(multiprocess, workers = cl))
suppressWarnings(plan(multiprocess, workers = 4))
estimates<- future_map(file_names,~{
df <- read_csv(., col_types = cols())
lm_each_subsample(mpg ~ wt, data = df, n = nrow(df), B = 40)
})
load_all()
library(devtools)
load_all()
library(blblm)
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
file_names <- file.path("mtcars", list.files("mtcars"))
file_names
par_blblm(mpg~cyl,file_names,B=1000,cl=2)
library(furrr)
par_blblm(mpg~cyl,file_names,B=1000,cl=2)
lm_each_subsample(formula=formula, data = df, n = nrow(df), B = 1000)
df <- read_csv("mtcars/1.csv", col_types = cols())
library(parallel)
library(tidyverse)
df <- read_csv("mtcars/1.csv", col_types = cols())
df <- read_csv("mtcars/1.csv", col_types = cols())
df <- read_csv("mtcars/1.csv", col_types = cols())
lm_each_subsample(mpg~wt, data = df, n = nrow(df), B = 1000)
lm_each_subsample(mpg~wt, data = df, n = nrow(df), B = 10)
suppressWarnings(plan(multiprocess, workers = cl))
suppressWarnings(plan(multiprocess, workers = 2))
estimates<- future_map(file_names,~{
df <- read_csv(., col_types = cols())
lm_each_subsample(formula=formula, data = df, n = nrow(df), B = B)
})
load_all()
lm_each_subsample(formula=formula, data = df, n = nrow(df), B = B)
lm_each_subsample(formula=formula, data = df, n = nrow(df), B = 100)
lm_each_subsample(mpg~cyl, data = df, n = nrow(df), B = 100)
par_blblm(mpg~cyl,file_names,B=1000,cl=2)
fit2 <- par_blblm(mpg~cyl,file_names,B=1000,cl=2)
foef(fit2)
coef(fit2)
source('~/blblm-master/R/blblm.R', echo=TRUE)
load_all()
fit2 <- par_blblm(mpg~cyl,file_names,B=1000)
file_names
fit2 <- par_blblm(cyl~mpg,file_names,B=1000)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit1)
sigma(fit)
sigma(fit1)
fit1
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit1)
sigma(fit1)
#' @export
par_blblm <- function(formula, file_names, B = 1000) {
m = length(file_names)
suppressWarnings(plan(multiprocess, workers =4))
estimates<- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(formula=formula, data = df, n = nrow(df), B = B)
})
res <- list(estimates = estimates, formula = formula)
class(res) <- "blblm"
invisible(res)
}
library(knitr)
opts_chunk$set(cache = TRUE)
suppressWarnings(plan(multiprocess, workers = 4))
########################
file_names <- file.path("flights", list.files("flights"))
m <- length(file_names)
mean_list <- file_names %>% future_map(~{
df <- read_csv(., col_types = cols())
mean(df$dep_delay, na.rm = TRUE)
})
(mean_dep_delay <- mean_list %>% reduce(`+`) / m)
#############
mean_list <- future_map(file_names,~{
df <- read_csv(., col_types = cols())
lm_each_subsample(dep_delay~arr_time, data = df, n = nrow(df), B = 30)
})
(mean_dep_delay <- mean_list %>% reduce(`+`) / m)
mean_list <- parLapply(cl, file_names, function(fname) {
df <- read_csv(fname, col_types = cols())
mean(df$dep_delay, na.rm = TRUE)
})
cl <- makeCluster(4)
# we will to manually load tidyverse in the workers
invisible(clusterEvalQ(cl, {
library(tidyverse)
NULL
}))
suppressWarnings(plan(multiprocess, workers = 4))
########################
file_names <- file.path("flights", list.files("flights"))
m <- length(file_names)
mean_list <- file_names %>% future_map(~{
df <- read_csv(., col_types = cols())
mean(df$dep_delay, na.rm = TRUE)
})
(mean_dep_delay <- mean_list %>% reduce(`+`) / m)
#############
mean_list <- future_map(file_names,~{
df <- read_csv(., col_types = cols())
lm_each_subsample(dep_delay~arr_time, data = df, n = nrow(df), B = 30)
})
(mean_dep_delay <- mean_list %>% reduce(`+`) / m)
file_names <- file.path("flights", list.files("flights"))
m <- length(file_names)
mean_list <- file_names %>% future_map(~{
df <- read_csv(., col_types = cols())
mean(df$dep_delay, na.rm = TRUE)
})
(mean_dep_delay <- mean_list %>% reduce(`+`) / m)
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(formula = formula, data = df, n = nrow(df), B = B)
})
B=100
file_names
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
file_names
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(formula = formula, data = df, n = nrow(df), B = B)
})
suppressWarnings(plan(multiprocess, workers =4))
B=100
file_names
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(formula = formula, data = df, n = nrow(df), B = B)
})
load_all()
fit1 <- blbglm(mpg ~ wt * hp,file_names,B=1000)
file_names
fit1 <- blbglm(mpg ~ wt * hp,mtcars,B=1000)
coef(fit1)
sigma(fit1)
source('~/blblm-master/R/blblm.R', echo=TRUE)
blbglm(mpg~cyl,file_names,B=1000)
blbglm(mpg~cyl,file_names,B=1000)
fit1 <- blbglm(mpg ~ wt * hp,file_names,B=1000)
coef(fit1)
sigma(fit1)
suppressWarnings(plan(multiprocess, workers =4))
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(formula = formula, data = df, n = nrow(df), B = B)
})
suppressWarnings(plan(multiprocess, workers =4))
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg ~ wt, data = df, n = nrow(df), B = B)
})
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg ~ wt*hp, data = df, n = nrow(df), B = B)
})
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = B)
})
df <- read_csv("mtcars/1.csv", col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = 1000)
df <- read_csv("mtcars/1.csv", col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = 10)
df <- read_csv("mtcars/1.csv", col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = 10)
par_blblm(mpg ~ wt,file_names,B=1000,cl=2)
load_all()
fit2 <- par_blblm(mpg ~ wt,file_names,B=1000,cl=2)
fit2 <- par_blblm(mpg ~ wt,file_names,B=1000)
file_names
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = B)
})
load_all()
par_blblm(mpg~wt,file_names=file_names,B=10,cl-2)
par_blblm(mpg~wt,file_names=file_names,B=10,cl=2)
check()
file_names
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit1)
sigma(fit1)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit1)
sigma(fit1)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=1000)
coef(fit1)
sigma(fit1)
fit1 <- blblm(mpg ~ wt * hp,file_names,B=500)
coef(fit1)
sigma(fit1)
fit1 <- blblm(mpg ~ wt,file_names,B=500)
coef(fit1)
sigma(fit1)
fit1 <- blblm(mpg ~ wt*hp,file_names,B=500)
coef(fit1)
sigma(fit1)
fit1 <- blblm(mpg ~ wt*cyl,file_names,B=500)
coef(fit1)
sigma(fit1)
fit1 <- blblm(mpg ~ wt*cyl,file_names,B=500)
coef(fit1)
sigma(fit1)
load_all()
source('~/blblm-master/R/blblm.R', echo=TRUE)
suppressWarnings(plan(multiprocess, workers =cl))
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg~cyl, data = df, n = nrow(df), B = B)
})
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(dep_delay~arr_time, data = df, n = nrow(df), B = B)
})
file_names <- c("flights/1.csv","flights/2.csv")
read_csv("flights/1.csv")
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(dep_delay~arr_time, data = df, n = nrow(df), B = B)
})
df <- read_csv(file_names, col_types = cols())
df
df <- read_csv("flights/1.csv", col_types = cols())
lm_each_subsample(formula = formula, data = df, n = nrow(df), B = 10)
lm_each_subsample(dep_delay~arr_time, data = df, n = nrow(df), B = 10)
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = B)
})
suppressWarnings(plan(multiprocess, workers =4))
file_names
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(dep_delay~arr_time, data = df, n = nrow(df), B = B)
})
m <- 3
groups <- sample(seq_len(m), nrow(mtcars), replace = TRUE)
mtcars$group <- groups
dir.create("mtcars/", showWarnings = FALSE)
for (i in seq_len(m)) {
write_csv(mtcars[which(mtcars$group==i),], str_c("mtcars/", i, ".csv"))
}
file_names <- file.path("mtcars", list.files("mtcars"))
fit1 <- blblm(mpg ~ wt*cyl,file_names,B=500)
coef(fit1)
sigma(fit1)
fit1 <- blblm(mpg ~ wt*cyl,file_names,B=1000)
coef(fit1)
sigma(fit1)
file_names
suppressWarnings(plan(multiprocess, workers =4))
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = B)
})
read_csv("mtcars/1.csv", col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = 100)
df
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = 100)
df
df <- read_csv("mtcars/1.csv", col_types = cols())
df
lm_each_subsample(mpg ~ cyl, data = df, n = nrow(df), B = 100)
lm1 <- lm(mpg~wt*hp,data=mtcars)
lm1$rank
lm1 <- lm(mpg~wt,data=mtcars)
lm(mpg~wt,data=mtcars)$rank
lm(mpg~wt*cyl*hp,data=mtcars)$rank
lm(mpg~wt*cyl*hp*disp,data=mtcars)$rank
file_names
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg~cyl, data = df, n = nrow(df), B = 10)
})
load_all()
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg~cyl, data = df, n = nrow(df), B = 10)
})
lm1 <- function(formula, data, freqs) {
# drop the original closure of formula,
# otherwise the formula will pick a wront variable from the global scope.
environment(formula) <- environment()
fit <- lm(formula, data, weights = freqs)
list(coef = blbcoef(fit), sigma = blbsigma(fit))
}
estimates <- future_map(file_names,~{
df <- read_csv(file_names, col_types = cols())
lm_each_subsample(mpg~cyl, data = df, n = nrow(df), B = 10)
})
lm_each_subsample(mpg~cyl, data = df, n = nrow(df), B = 10)
df
blblm(mpg~cyl,file_names,B=10)
fit <- blblm(mpg~cyl,file_names,B=10)
coef(fit)
fit <- blbglm(mpg~cyl,file_names,B=10)
coef(fit)
fit3 <- blbglm(mpg ~ wt * hp,file_names,B=1000)
coef(fit3)
sigma(fit3)
rsconnect::setAccountInfo(name='yuzhezhang', token='A28F8A185364D8B10F0337678560E45E', secret='EYJQQJ/aHV1jMSyUWyXtk3ZLStFeJf62KVz69vyk')
library(rsconnect)
rsconnect::deployApp('C:/Users/Administrator/Documents/STA141B~Final/Final/app.R')
check()
